"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[903],{6903:(e,t,o)=>{o.r(t),o.d(t,{default:()=>z});var n=o(5155);o(8413),o(1866),o(3919);var l=o(6756),s=o(833),a=o(5402),i=o(3710),r=o(3314),c=o(7288);let d=[{name:"Varndean School",catchment:"StringerVarndean",lng:-.13648267150638296,lat:50.84996246606285,entrances:[{lat:50.848958,lng:-.136222},{lat:50.850123,lng:-.13515}],colour:"red"},{name:"Dorthy Stringer",catchment:"StringerVarndean",lng:-.14334912643220177,lat:50.84877028209984,entrances:[{lat:50.849719,lng:-.142787},{lat:50.846838,lng:-.141942}],colour:"blue"},{name:"Hove Park",catchment:"BlatchingtonHove",lng:-.179361,lat:50.840592,entrances:[{lat:50.839065,lng:-.180437},{lat:50.840592,lng:-.178157}],colour:"green"},{name:"Blatchington Mill",catchment:"BlatchingtonHove",lng:-.18379413197832176,lat:50.84494638334588,entrances:[{lat:50.84235,lng:-.183161},{lat:50.845649,lng:-.181637}],colour:"purple"},{name:"Patcham High",catchment:"PatchamHigh",lng:-.14338958779814723,lat:50.86270805216661,entrances:[{lat:50.862404,lng:-.142905},{lat:50.863767,lng:-.144205}],colour:"orange"},{name:"Longhill High",catchment:"Longhill",lng:-.06719373251716731,lat:50.81838888519547,entrances:[],colour:"yellow"},{name:"BACA",catchment:"BrightonAldridge",lng:-.09278489104966146,lat:50.85880054711686,entrances:[{lat:50.85806,lng:-.093756},{lat:50.858166,lng:-.087841}],colour:"black"},{name:"PACA",catchment:"Portslade",lng:-.22580460499288743,lat:50.85085909379337,entrances:[],colour:"grey"}];var h=o(2115),u=o(8741),m=o.n(u),p=o(8416),g=o(6417),x=o(7753),y=o(6214),j=o(5417),v=o(152),w=o(894),f=o(6854),b=o(6924),C=o(1451),A=o(6805),S=o(810),D=o(8984),B=o(2282),k=o(1482),P=o(5480),R=o(2111),H=o(507),T=function(e){return e[e.HidePostcodes=0]="HidePostcodes",e[e.ShowPostcodes=1]="ShowPostcodes",e[e.ClosestSchool=2]="ClosestSchool",e[e.SecondClosestSchool=3]="SecondClosestSchool",e[e.ThirdClosestSchool=4]="ThirdClosestSchool",e[e.showDistanceMap=5]="showDistanceMap",e[e.ClosestPlacedSchool=6]="ClosestPlacedSchool",e[e.CatchmentSchoolDist=7]="CatchmentSchoolDist",e}(T||{}),M=function(e){return e[e.HideCatchments=0]="HideCatchments",e[e.OldCatchments=1]="OldCatchments",e[e.NewCatchments=2]="NewCatchments",e}(M||{});let J=e=>m().divIcon({className:"custom-disk-icon",html:'<div style="background-color: '.concat(e,'; width: 10px; height: 10px; border-radius: 50%;"></div>'),iconSize:[10,10],iconAnchor:[5,5]}),I=async()=>({default:[...await o.e(544).then(o.t.bind(o,8544,19)).then(e=>e.default),...await o.e(933).then(o.t.bind(o,2933,19)).then(e=>e.default)]}).default,L=async()=>{let e=await o.e(88).then(o.t.bind(o,6088,19)).then(e=>e.default);return{old:{catchments:(await o.e(649).then(o.t.bind(o,9649,19)).then(e=>e.default)).catchments},new:{catchments:e.catchments}}},O=(e,t)=>{let o=0;for(let l=0;l<d.length;++l){var n;let s=d[l],a=t?e.newCatchment:e.oldCatchment;if(s.catchment===a&&(null==e?void 0:null===(n=e.journeys)||void 0===n?void 0:n.walking))for(let t of e.journeys.walking)t.name===s.name&&t.distance>o&&(o=t.distance,s.name)}return o},z=()=>{var e,t;let[o,u]=(0,h.useState)([]),[m,T]=(0,h.useState)({old:{catchments:[]},new:{catchments:[]}}),[M,z]=(0,h.useState)({id:0,startPoint:[0,0],schoolJourneys:[]}),[F,W]=(0,h.useState)(1),[N,V]=(0,h.useState)(2),[_,E]=(0,h.useState)(!1),[G,U]=(0,h.useState)(""),[Y,Z]=(0,h.useState)(4),[q,K]=(0,h.useState)(!0),[Q,X]=(0,h.useState)("walking"),[$,ee]=(0,h.useState)(!0);(0,h.useEffect)(()=>{I().then(e=>{u(e.map(e=>{if(e.journeys){var t,o,n,l;e.journeys.walking=null===(o=e.journeys)||void 0===o?void 0:null===(t=o.walking)||void 0===t?void 0:t.sort((e,t)=>e.distance-t.distance),e.journeys.bus=null===(l=e.journeys)||void 0===l?void 0:null===(n=l.bus)||void 0===n?void 0:n.sort((e,t)=>e.distance-t.distance)}return e})),K(!1)}),L().then(e=>{T(e)})},[]);let et=e=>{z({...M,schoolJourneys:M.schoolJourneys.map(t=>t.name===e?{...t,renderRoute:!t.renderRoute}:t)})},eo=e=>{let t=(Math.max(.5,Math.min(Y,e))-.5)/(Y-.5),o=Math.floor(255*t),n=Math.floor(255*(1-t));return"rgb(".concat(o,",").concat(n,",0)")},en=()=>{ee(!$)};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(p.A,{id:"d",open:$,onClose:en,children:[(0,n.jsx)(g.A,{children:"Welcome to the Map"}),(0,n.jsxs)(x.A,{children:[(0,n.jsx)("p",{style:{marginBottom:"1rem"},children:"This map allows you to explore routes to schools. A blur dot is a postcode. Click on a blue dot to see the route to schools. The left hand panel show the distance and time to each school. These are safe walking distances as determined by OpenRouteService (https://openrouteservice.org/)"}),(0,n.jsx)("p",{style:{marginBottom:"1rem"},children:"Click on the bus route to load the Brighon and Hove bus website for that postcode to school journey."}),(0,n.jsx)("p",{style:{marginBottom:"1rem"},children:"Use the dropdowns to change the catchment boundaries overlays (these aren't exact as the council don't provide the data)."}),(0,n.jsx)("p",{style:{marginBottom:"1rem"},children:"The Render options drop down allows you to see the closest school, 2nd closest school, 3rd closest school for each postcode. School colour code is on the left."}),(0,n.jsx)("p",{style:{marginBottom:"1rem"},children:'The closest placed school shows all postcodes whose closest placed school is over the max dist - set in the "Max Distance" box. A placed school is BACA, PACA and Longhill as the council data shows these are the only schools that will have spare places for displaced pupils.'}),(0,n.jsx)("p",{style:{marginBottom:"1rem"},children:'Catchment School Dist displays a red dot for any postcode whose furthest away catchment school is over max dist - set in the "Max Distance box". Distances are in miles.'}),(0,n.jsx)("p",{style:{marginBottom:"1rem"},children:"The Schools drop down allows you see a distance map to the selected school."}),(0,n.jsx)("p",{})]}),(0,n.jsx)(y.A,{children:(0,n.jsx)(B.A,{onClick:en,color:"primary",children:"Got it!"})})]}),(0,n.jsxs)(j.Ay,{container:!0,spacing:2,style:{height:"100%"},children:[(0,n.jsx)(j.Ay,{item:!0,xs:2,style:{height:"100%"},children:(0,n.jsxs)("div",{style:{backgroundColor:"white",overflowY:"auto",padding:"10px"},children:[(0,n.jsx)("h2",{children:"Colours"}),(0,n.jsx)("ul",{children:d.map(e=>(0,n.jsxs)("li",{style:{color:e.colour},children:[e.name,": ",e.colour]},e.name))}),(0,n.jsxs)("h2",{style:{fontWeight:"bold",paddingTop:"10px"},children:["Route Information ",M.postcode]}),null===(e=M.schoolJourneys)||void 0===e?void 0:e.map(e=>(0,n.jsxs)("div",{style:{marginBottom:"1rem"},children:[(0,n.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,n.jsxs)("div",{style:{fontWeight:"bold",color:e.colour},children:[e.name," - ",e.journeyType]}),(0,n.jsx)("button",{onClick:()=>et(e.name||""),style:{backgroundColor:e.renderRoute?"#f44336":"#4CAF50",color:"white",border:"none",padding:"1px 2px",textAlign:"center",textDecoration:"none",display:"inline-block",fontSize:"10px",margin:"2px 2px",cursor:"pointer",borderRadius:"1px"},children:e.renderRoute?"Hide Route":"Show Route"}),(0,n.jsx)("button",{onClick:()=>{var t;let o=null===(t=M.postcode)||void 0===t?void 0:t.replace(/ /g,"+").toUpperCase(),n=Array.isArray(M.startPoint)?M.startPoint[0]:M.startPoint.lat,l=Array.isArray(M.startPoint)?M.startPoint[1]:M.startPoint.lng,s=e.location.lat,a=e.location.lng,i=new Date,r=new Date(i);r.setDate(i.getDate()+1),5===i.getDay()?r.setDate(i.getDate()+3):6===i.getDay()&&r.setDate(i.getDate()+2);let c=r.toISOString().split("T")[0],d="https://www.buses.co.uk/directions?origin%5Bname%5D=".concat(o,"&origin%5Blocation%5D%5Blat%5D=").concat(n,"&origin%5Blocation%5D%5Blon%5D=").concat(l,"&destination%5Bname%5D=School&destination%5Blocation%5D%5Blat%5D=").concat(s,"&destination%5Blocation%5D%5Blon%5D=").concat(a,"&time%5Bwhen%5D=arrive&time%5Bdate%5D=").concat(c,"&time%5Btime%5D=09%3A00");window.open(d,"us route")},style:{backgroundColor:"black",color:"white",border:"none",padding:"1px 2px",textAlign:"center",textDecoration:"none",display:"inline-block",fontSize:"10px",margin:"2px 2px",cursor:"pointer",borderRadius:"1px"},children:'"Bus route"'})]}),(0,n.jsxs)("div",{style:{paddingLeft:"1rem"},children:[e.distance.toFixed(2)," miles"]}),(0,n.jsxs)("div",{style:{paddingLeft:"1rem"},children:[e.duration.toFixed(2)," minutes"]})]},"dd"+e.name))]})}),(0,n.jsxs)(j.Ay,{item:!0,xs:10,style:{height:"100%"},children:[(0,n.jsx)(C.A,{position:"static",children:(0,n.jsxs)(A.A,{style:{paddingTop:"10px",paddingBottom:"10px",alignItems:"center",justifyContent:"flex-start",gap:"10px"},children:[(0,n.jsx)(S.A,{variant:"h6",style:{flexGrow:0}}),(0,n.jsxs)(R.A,{variant:"outlined",children:[(0,n.jsx)(H.A,{id:"catchment-select-label",children:"Catchment Boundaries"}),(0,n.jsxs)(k.A,{labelId:"catchment-select-label",id:"catchment-select",value:N,onChange:e=>V(e.target.value),label:"Catchment Boundaries",children:[(0,n.jsx)(P.A,{value:0,children:"Hide Catchments"}),(0,n.jsx)(P.A,{value:1,children:"Old Catchments"}),(0,n.jsx)(P.A,{value:2,children:"New Catchments"})]})]}),(0,n.jsx)(B.A,{color:"inherit",onClick:()=>{W(F?0:1)},children:0!=F?"Hide Postcodes":"Show Postcodes"}),(0,n.jsxs)(R.A,{variant:"outlined",style:{minWidth:200,marginLeft:"10px"},children:[(0,n.jsx)(H.A,{id:"render-options-select-label",children:"Render Options"}),(0,n.jsxs)(k.A,{labelId:"render-options-select-label",id:"render-options-select",value:F,onChange:e=>{W(e.target.value),u([...o])},label:"Render Options",children:[(0,n.jsx)(P.A,{value:2,children:"Closest School"}),(0,n.jsx)(P.A,{value:3,children:"2nd Closest School"}),(0,n.jsx)(P.A,{value:4,children:"3rd Closest School"}),(0,n.jsx)(P.A,{value:6,children:"Closest Placed School"}),(0,n.jsx)(P.A,{value:7,children:"Catchment School Dist"})]})]}),(0,n.jsxs)(R.A,{variant:"outlined",style:{minWidth:120,marginLeft:"10px"},children:[(0,n.jsx)(H.A,{id:"school-select-label",children:"Schools"}),(0,n.jsx)(k.A,{labelId:"school-select-label",id:"school-select",label:"Schools",onChange:e=>{let t=d.find(t=>t.name===e.target.value);U((null==t?void 0:t.name)||""),W(5)},children:d.map(e=>(0,n.jsx)(P.A,{value:e.name,children:e.name},e.name))})]}),(0,n.jsx)(v.A,{label:"Max Distance (miles)",type:"number",value:Y,onChange:e=>Z(parseFloat(e.target.value)),style:{padding:"2px",marginLeft:"10px",width:"150px"}}),(0,n.jsx)(D.A,{title:"Help",onClick:en,children:(0,n.jsx)(w.A,{color:"inherit",children:(0,n.jsx)(b.A,{})})})]})}),q&&(0,n.jsx)("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",zIndex:1e3},children:(0,n.jsx)(f.A,{})}),(0,n.jsxs)(s.W,{id:"map"+Date.now(),center:[50.84078,-.14691],zoom:13,scrollWheelZoom:!0,style:{height:"100%",width:"100%",cursor:"crosshair"},children:[(0,n.jsx)(a.e,{attribution:'\xa9 <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),d.map(e=>(0,n.jsx)(i.p,{position:[e.lat,e.lng],children:(0,n.jsx)(r.z,{children:e.name},"ss"+e.name)},"s"+e.name)),(0,n.jsx)(()=>((0,l.Po)({click:e=>{if(_){let{lat:t,lng:o}=e.latlng;z({id:0,startPoint:[t,o],schoolJourneys:[]}),(async()=>{let e=await fetch("/api/distances?lat=".concat(t,"&lng=").concat(o));if(e.ok){let n=await e.json();M.schoolJourneys=n.schoolJourneys.map(e=>(e.renderRoute=!0,e)),M.startPoint=[t,o],z(M)}else console.error("Failed to fetch distances:",e.statusText)})()}}}),null),{}),0!=N&&(2==N?m.new.catchments:m.old.catchments).map(e=>(0,n.jsx)(c.R,{positions:e.coordinates,color:"grey"},"c"+e.name)),(1==F||2==F||3==F||4==F||6==F||7==F)&&o.map(e=>{var t,o;let l="blue";if(6==F&&e.journeys){let o=null===(t=e.journeys[Q])||void 0===t?void 0:t.filter(t=>t.name===e.closestPlacement)[0];if(!o||!(o.distance>Y)||"StringerVarndean"!==e.newCatchment&&"BlatchingtonHove"!==e.newCatchment)return;l="red"}else if(7==F&&e.journeys){if(!(O(e,2===N)>Y))return;l="red"}else if(F>1&&e.journeys){let t=null===(o=e.journeys[Q])||void 0===o?void 0:o[F-2];l=t&&"string"==typeof t.colour?t.colour:"blue"}return(0,n.jsx)(i.p,{position:[e.lat,e.lng],icon:J(l),eventHandlers:{click:()=>{var t;let o=null===(t=e.journeys)||void 0===t?void 0:t[Q];z({id:0,startPoint:[e.lat,e.lng],postcode:e.postcode,schoolJourneys:o?o.map(e=>({...e,renderRoute:!0,id:0,colour:e.colour||"white"})):[]})}}},e.postcode)}),5==F&&G&&o.map(e=>{var t,o;let l=null===(t=e.journeys)||void 0===t?void 0:t[Q],s=eo((null==l?void 0:null===(o=l.find(e=>e.name===G))||void 0===o?void 0:o.distance)||0);return(0,n.jsx)(i.p,{position:[e.lat,e.lng],icon:J(s),eventHandlers:{click:()=>{var t;let o=null===(t=e.journeys)||void 0===t?void 0:t[Q];z({id:0,startPoint:[e.lat,e.lng],schoolJourneys:o?o.map(e=>({...e,renderRoute:!0,id:0,colour:e.colour||"white"})):[]})}}},e.postcode)}),null===(t=M.schoolJourneys)||void 0===t?void 0:t.map(e=>e.renderRoute&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(c.R,{positions:e.route,color:e.colour},"p"+e.name),(0,n.jsx)(i.p,{position:M.startPoint,icon:J("red")},"m"+e.name)]}))]})]})]})]})}}}]);